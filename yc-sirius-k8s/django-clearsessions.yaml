apiVersion: batch/v1
kind: CronJob
metadata:
  name: django-clearsessions-cronjob
  namespace:
  labels:
    env: dev
    app: service
spec:
  schedule: "0 2 * * *"
  startingDeadlineSeconds: 60
  jobTemplate:
    spec:
      ttlSecondsAfterFinished: 300
      template:
        spec:
          restartPolicy: Never
          containers:
            - name: django-clearsessions
              image: anneg8/django_app:latest
              command: [ "python", "manage.py", "clearsessions" ]
              envFrom:
                - secretRef:
                    name: django-secret
              env:
                - name: DATABASE_URL
                  valueFrom:
                    secretKeyRef:
                      name: postgres
                      key: dsn
              volumeMounts:
                - name: pg-cert-volume
                  mountPath: /root/.postgresql/root.crt
                  subPath: root.crt
                  readOnly: true
          volumes:
            - name: pg-cert-volume
              secret:
                secretName: pg-root-cert
